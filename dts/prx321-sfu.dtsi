#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/net/lantiq,prx300-eth.h>
#include "prx300.dtsi"

/******************************************************************************
 ** Board configuration: Enable Shift register LED board configuration.
 ******************************************************************************/
&ssogpio {
	status = "okay";
	ngpios = <16>;
	intel,sso-update-rate = <250000>;
	/* Shift clk freq: 25MHz, 12.5MHz, 6.25MHz, 3.125Mz */
	intel,sso-shift-clk-freq = <6250000>;
};

&ssoled {
	status = "okay";

	/* led definition */
	intel,sso-def-brightness = <0>; /* default off */
	/* blink rate list: 2, 4, 8, 10, 50K, 100K, 200K, 250K*/
	intel,sso-def-blinkrate = <250000>;

	/*
	 * All pin numbers here are (31-original number) for the V1.1 board.
	 * For the dual color leds the label uses the same number to indicate
	 * the connection.
	 */
	led5: led5 {
		label = "led5:green:pon";
		led-gpio = <&ssogpio 5 GPIO_ACTIVE_HIGH>;
		intel,led-pin = <5>;
	};

	led6: led6 {
		label = "led5:red:pon";
		led-gpio = <&ssogpio 6 GPIO_ACTIVE_HIGH>;
		intel,led-pin = <6>;
	};

	led7: led7 {
		label = "led7:green:voice0";
		led-gpio = <&ssogpio 7 GPIO_ACTIVE_HIGH>;
		intel,led-pin = <7>;
	};

	led8: led8 {
		label = "led8:green:voice1";
		led-gpio = <&ssogpio 8 GPIO_ACTIVE_HIGH>;
		intel,led-pin = <8>;
	};

	led9: led9 {
		/* in HW manual this is the DECT LED */
		label = "led9:green:status";
		led-gpio = <&ssogpio 9 GPIO_ACTIVE_HIGH>;
		intel,led-pin = <9>;
	};

	led2: led2 {
		label = "led2:green:gphy";
		led-gpio = <&ssogpio 2 GPIO_ACTIVE_HIGH>;
		intel,led-pin = <2>;
	};

	led3: led3 {
		label = "led2:red:gphy";
		led-gpio = <&ssogpio 3 GPIO_ACTIVE_HIGH>;
		intel,led-pin = <3>;
	};

	led4: led4 {
		label = "led4:yellow:gphy";
		led-gpio = <&ssogpio 4 GPIO_ACTIVE_HIGH>;
		intel,led-pin = <4>;
	};

};

/******************************************************************************
 ** Board configuration: Enable I2C for WAN transceiver EEPROM
 ******************************************************************************/

/ {
	aliases {
		i2c0	= &i2c_gpio;
	};

	i2c_gpio: i2c-gpio-0 {
		compatible = "i2c-gpio";
		gpios = <&gpio0 27 GPIO_ACTIVE_HIGH /* sda */
			 &gpio0 26 GPIO_ACTIVE_HIGH /* scl */
			>;
		i2c-gpio,delay-us = <5>;	/* ~100 kHz */
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_i2c0_gpio>;
		#address-cells = <1>;
		#size-cells = <0>;

		/* EEPROM of the optical WAN transceiver */
		eeprom@50 {
			compatible = "at,24c02";
			reg = <0x50>;
		};
		eeprom@51 {
			compatible = "at,24c02";
			reg = <0x51>;
		};
	};
};

/******************************************************************************
 ** Board configuration: Configure LAN/WAN interfaces
 ******************************************************************************/
&eth {
	status = "okay";

	lan0: interface@0 {
		status = "okay";
		compatible = "lantiq,xrx500-pdi";
		#address-cells = <1>;
		#size-cells = <0>;
		reg = <0>;
		intel,dp-dev-port = <3>;
		intel,dp-port-id = <3>;
		mac = <&gsw_mac1>;
		intel,lct-en = <1>;
		intel,extra-subif = <4>;
		/* Specify traffic domains for LAN interfaces:
		 * [LAN/LCT]	- UNI_BR_DOMAIN_UC  - Unicast
		 * [MC]		- UNI_BR_DOMAIN_MC  - Multicast
		 * [BC]		- UNI_BR_DOMAIN_BC1 - Broadcast one
		 * [US]		- UNI_BR_DOMAIN_US  - Upstream
		 */
		mxl,bridge-domain = <UNI_BR_DOMAIN_UC>, <UNI_BR_DOMAIN_UC>,
				    <UNI_BR_DOMAIN_MC>, <UNI_BR_DOMAIN_BC1>,
				    <UNI_BR_DOMAIN_US>;

		lan0_port: ethernet@1 {
			compatible = "lantiq,xrx500-pdi-port";
			reg = <1>;
			phy-mode = "rgmii";
			phy-handle = <&aquantia_phy>;
		};
	};

	lan1: interface@1 {
		status = "okay";
		compatible = "lantiq,xrx500-pdi";
		#address-cells = <1>;
		#size-cells = <0>;
		reg = <1>;
		intel,dp-dev-port = <4>;
		intel,dp-port-id = <4>;
		mac = <&gsw_mac2>;
		intel,lct-en = <1>;
		intel,extra-subif = <4>;
		/* Specify traffic domains for LAN interfaces:
		 * [LAN/LCT]	- UNI_BR_DOMAIN_UC  - Unicast
		 * [MC]		- UNI_BR_DOMAIN_MC  - Multicast
		 * [BC]		- UNI_BR_DOMAIN_BC2 - Broadcast two
		 * [US]		- UNI_BR_DOMAIN_US  - Upstream
		 */
		mxl,bridge-domain = <UNI_BR_DOMAIN_UC>, <UNI_BR_DOMAIN_UC>,
				    <UNI_BR_DOMAIN_MC>, <UNI_BR_DOMAIN_BC2>,
				    <UNI_BR_DOMAIN_US>;

		ethernet@2 {
			compatible = "lantiq,xrx500-pdi-port";
			reg = <2>;
			phy-mode = "rgmii";
			phy-handle = <&gphy>;
		};
	};

	wan: interface@5 {
		status = "disabled";
		compatible = "lantiq,xrx500-pdi";
		#address-cells = <1>;
		#size-cells = <0>;
		reg = <5>;
		lantiq,wan = <1>;
		intel,dp-dev-port = <2>;
		intel,dp-port-id = <2>;
		mac = <&gsw_mac0>;

		ethernet@5 {
			compatible = "lantiq,xrx500-pdi-port";
			reg = <1>;
			phy-mode = "rgmii";
		};
	};
};

/* xgmac mdio pins */
&gsw_mac1 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_mdio0>;
	/* Aquantia PHY reset */
	reset-gpios = <&ssogpio 13 GPIO_ACTIVE_LOW>;
};

&gsw_mac2 {
	/* Ingress/Egress timestamping latency
	 * correction for internal GPHY attached to XGMAC4
	 */
	ts-ig-corr = <(-382)>;
	ts-eg-corr = <150>;
};

/* mdio0 bus */
&mdio0 {
	#address-cells = <1>;
	#size-cells = <0>;
	aquantia_phy: ethernet-phy@0 {
		reg = <0x0>;
		compatible = "ethernet-phy-ieee802.3-c45";
	};
};

/* This is needed to improve qspi stability on the board */
&pinctrl_qspi {
	intel,slew-rate = <1>;
	intel,drive-current = <3>;
};

&ssc0 {
	pinctrl-0 = <&pinctrl_spi0_alt &pinctrl_spi0_cs_alt>;

	ltq-spinand@1 {
		status = "disabled";
		#address-cells = <1>;
		#size-cells = <1>;
		reg = <1>;
		compatible = "lantiq,spinand";
		linux,mtd-name = "nand.0";
		spi-max-frequency = <15384615>;
	};
};

&qspi0 {
	ltq-spinand@0 {
		status = "disabled";
		#address-cells = <1>;
		#size-cells = <1>;
		compatible = "lantiq,spinand";
		reg = <0 1>;
		linux,mtd-name = "nand.0";
		spi-max-frequency = <50000000>;
		page-size = <2048>;
		block-size = <17>; // 2^17, 128KB
		spi-tx-bus-width = <4>;
		spi-rx-bus-width = <4>;

		/* Read-delay is needed for higher freq.
		 * 2 ref_clk is chosen as value that works well upto
		 * spi-freq 50MHz (with ref_clk 100MHz).
		 */
		read-delay = <2>;
		tshsl-ns = <200>;
		tsd2d-ns = <255>;
		tchsh-ns = <20>;
		tslch-ns = <20>;
	};
};

&cb0phy0 {
	status = "okay";
	intel,mode = <1>; /*0-pcie, 1-xpcs*/
};

&cb0phy1 {
	status = "disabled";
	intel,mode = <1>; /*0-pcie, 1-xpcs*/
};

&wan_xpcs_phy {
	status = "disabled";
};

&wan_xpcs {
	status = "disabled";
	xpcs-conntype = "SFP"; /* SFP or PHY */
	xpcs-no-phy-rx-auto-adapt; /* <2dB loss PHY auto adapt not needed*/
	/* xpcs RX EQ Settings */
	xpcs-afe_en = <0x0>, <0x0>, <0x0>, <0x0>;
	xpcs-dfe_en = <0x0>, <0x0>, <0x0>, <0x0>;
	xpcs-cont_adapt_en = <0x0>, <0x0>, <0x0>, <0x0>;
	xpcs-rx_attn_lvl = <0x7>, <0x7>, <0x7>, <0x7>;
	xpcs-rx_ctle_boost = <0x0>, <0x0>, <0x0>, <0x0>;
	xpcs-rx_ctle_pole = <0x6>, <0x6>, <0x6>, <0x6>;
	xpcs-rx_vga2_gain = <0x5>, <0x5>, <0x5>, <0x5>;
	xpcs-rx_vga1_gain = <0x5>, <0x5>, <0x5>, <0x5>;
	/* xpcs TX EQ Settings */
	xpcs-tx_eq_pre = <0x5>, <0x5>, <0x0>, <0x0>;
	xpcs-tx_eq_post =  <0x14>, <0x14>, <0x1>, <0x1>;
	xpcs-tx_eq_main = <0x18>, <0x18>, <0xC>, <0xC>;
	xpcs-tx_iboost_lvl = <0xF>, <0xF>,<0xF>, <0xF>;
	xpcs-tx_vboost_lvl = <0x5>, <0x5>, <0x5>, <0x5>;
	xpcs-tx_vboost_en = <0x1>, <0x1>, <0x1>, <0x1>;
};

&lan_xpcs0 {
	status = "okay";
	xpcs-mode = <0>; /* 0 - 10G_KR_MODE, 1 - 10G_XAUI_MODE, 2 - 1G_XAUI_MODE, 3 - 2P5G_GMII_MODE */
	xpcs-conntype = "SFP"; /* SFP or PHY */
	xpcs-no-phy-rx-auto-adapt; /* <2dB loss PHY auto adapt not needed*/
	/* xpcs RX EQ Settings */
	xpcs-afe_en = <0x0>, <0x0>, <0x0>, <0x0>;
	xpcs-dfe_en = <0x0>, <0x0>, <0x0>, <0x0>;
	xpcs-cont_adapt_en = <0x0>, <0x0>, <0x0>, <0x0>;
	xpcs-rx_attn_lvl = <0x7>, <0x7>, <0x7>, <0x7>;
	xpcs-rx_ctle_boost = <0x0>, <0x0>, <0x0>, <0x0>;
	xpcs-rx_ctle_pole = <0x6>, <0x6>, <0x6>, <0x6>;
	xpcs-rx_vga2_gain = <0x5>, <0x5>, <0x5>, <0x5>;
	xpcs-rx_vga1_gain = <0x5>, <0x5>, <0x5>, <0x5>;
	/* xpcs TX EQ Settings */
	xpcs-tx_eq_pre = <0x0>, <0x0>, <0x0>, <0x0>;
	xpcs-tx_eq_post =  <0x0>, <0x0>, <0x1>, <0x1>;
	xpcs-tx_eq_main = <0x28>, <0x28>, <0xC>, <0xC>;
	xpcs-tx_iboost_lvl = <0xF>, <0xF>,<0xF>, <0xF>;
	xpcs-tx_vboost_lvl = <0x5>, <0x5>, <0x5>, <0x5>;
	xpcs-tx_vboost_en = <0x1>, <0x1>, <0x1>, <0x1>;
	link_poll_interval = <2>;
	xpcs_mode_cfg_seq = <0 3 2 1>;
};

&lan_xpcs1 {
	status = "disabled";
	xpcs-conntype = "SFP"; /* SFP or PHY */
	xpcs-no-phy-rx-auto-adapt; /* <2dB loss PHY auto adapt not needed*/
	/* xpcs RX EQ Settings */
	xpcs-afe_en = <0x0>, <0x0>, <0x0>, <0x0>;
	xpcs-dfe_en = <0x0>, <0x0>, <0x0>, <0x0>;
	xpcs-cont_adapt_en = <0x0>, <0x0>, <0x0>, <0x0>;
	xpcs-rx_attn_lvl = <0x7>, <0x7>, <0x7>, <0x7>;
	xpcs-rx_ctle_boost = <0x0>, <0x0>, <0x0>, <0x0>;
	xpcs-rx_ctle_pole = <0x6>, <0x6>, <0x6>, <6>;
	xpcs-rx_vga2_gain = <0x5>, <0x5>, <0x5>, <0x5>;
	xpcs-rx_vga1_gain = <0x5>, <0x5>, <0x5>, <0x5>;
	/* xpcs TX EQ Settings */
	xpcs-tx_eq_pre = <0x0>, <0x0>, <0x0>, <0x0>;
	xpcs-tx_eq_post =  <0x0>, <0x0>, <0x1>, <0x1>;
	xpcs-tx_eq_main = <0x28>, <0x28>, <0xC>, <0xC>;
	xpcs-tx_iboost_lvl = <0xF>, <0xF>,<0xF>, <0xF>;
	xpcs-tx_vboost_lvl = <0x5>, <0x5>, <0x5>, <0x5>;
	xpcs-tx_vboost_en = <0x1>, <0x1>, <0x1>, <0x1>;
};

&gphy_fw {
	status = "okay";
};

&gphy {
	status = "okay";
};

/******************************************************************************
** Board configuration: Enable voice
******************************************************************************/

/* Use CPU1 for voice firmware. */
&cpu1 {
        default-OS = "VOICEFW";
};

/* Use SSO pin 15 for SLC200 reset. */
&ssi_rst_sso {
        status = "okay";
};

/* Do not use GPIO for SLC200 reset. */
&vcodec {
        pinctrl-0 = <&pinctrl_ssi &pinctrl_ssi_rx>;
};

&gptc0 {
	status = "okay";
	intel,clk = <&clocksource 3 1 0 10>;
};
